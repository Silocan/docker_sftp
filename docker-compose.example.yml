version: '3.8'

services:
  sftp:
    build: .
    container_name: sftp_server
    ports:
      - "2222:22"
    volumes:
      - ./data:/data
    environment:
      # Premier utilisateur
      - SFTP_USER_1=client1
      - SFTP_PASSWORD_1=secret123
      - SFTP_DIR_1=client1_files
      
      # Deuxième utilisateur
      - SFTP_USER_2=client2
      - SFTP_PASSWORD_2=secret456
      - SFTP_DIR_2=client2_files
      
      # Troisième utilisateur (le dossier par défaut sera "client3")
      - SFTP_USER_3=client3
      - SFTP_PASSWORD_3=secret789
    restart: unless-stopped
    networks:
      - sftp_network

  # Exemple: un autre service qui peut accéder au SFTP
  client:
    image: alpine:latest
    container_name: sftp_client
    command: sh -c "apk add --no-cache openssh-client && sleep infinity"
    networks:
      - sftp_network
    depends_on:
      - sftp
    # Pour tester: docker exec -it sftp_client sh
    # Puis: sftp -P 22 client1@sftp
    #      sftp -P 22 client2@sftp
    #      sftp -P 22 client3@sftp

networks:
  sftp_network:
    driver: bridge